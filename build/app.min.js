/*! ewallet 05-12-2018 */

!function(){function e(){return{renderLogin:function(){if(a().getCookie())Finch.navigate("dashboard"),this.renderDashboard();else{var e=$("#loginView").html();Finch.navigate("login"),a().render(e)}},renderRegister:function(){var e=$("#registerView").html();Finch.navigate("register"),a().render(e)},renderForget:function(){var e=$("#forgetView").html();Finch.navigate("forget"),a().render(e)},renderDashboard:function(){var e=JSON.parse(a().getCookie()),t=(e.access_token,e.id);a().getCookie()?$.ajax({type:"get",url:"localhost/ewallet/server/categories/users/"+t,success:function(e){$("#menu").hide();e.data.length;var t=$("#dashboardView").html(),n=Handlebars.compile(t),o={a:"a"};console.log(o),$("#small-content-placeholder").html(n(o))},error:function(e){a.log(e)}}):Finch.navigate("login")}}}function r(){return{login:function(e){return i().post({url:"users/login",payload:e})},register:function(e){return i().post({url:"users/register",payload:e})},forget:function(e){return i().post({url:"users/forget",payload:e})},recovery:function(e){return i().post({url:"users/recovery",payload:e})},resendEmail:function(e){return i().post({url:"users/resendEmail",payload:e})}}}function a(){return{render:function(e){$("#render").html(e)},log:function(e){"production"==config().mode&&console.log(e)},setCookie:function(e){localStorage.setItem("ewallet",e)},getCookie:function(){return localStorage.getItem("ewallet")},delCookie:function(){return localStorage.clear()}}}function i(){return{post:function(e){return $.post("localhost/ewallet/server/"+e.url,e.payload)}}}$(document).on("click","#logoutSubmit",function(e){e.preventDefault(),a().delCookie();var t=$("#registerView").html();Finch.navigate("login"),a().render(t),location.reload(),a().log(e)}),$(document).on("click","#addCategory",function(e){e.preventDefault(),Finch.navigate("add")}),$(document).on("click","#edit",function(e){e.preventDefault(),alert("edit")}),$(document).on("click","#delete",function(e){e.preventDefault(),alert("edit")}),$(document).on("submit","#addCategorySubmit",function(e){e.preventDefault();var t={};t.title=$("#title").val();var n=a().getCookie();n=JSON.parse(n),t.user_id=n.id,t=JSON.stringify(t);var o;(o=t,i().post({url:"categories/addCategory/",payload:o})).then(function(e){Finch.navigate("dashboard")},function(e){a.log(e)})}),$(document).on("submit","#loginSubmit",function(e){e.preventDefault();var t={};t.email=$("#email").val(),t.password=$("#password").val(),t=JSON.stringify(t);r().login(t).then(function(e){var t={access_token:e.data.jwt,id:e.data.id};t=JSON.stringify(t),a().setCookie(t),"{}"==a().getCookie()?alert("Invalid One"):Finch.navigate("dashboard"),a().log(e)},function(e){console.log(e,"err"),a().log(e)})}),$(document).on("submit","#registerSubmit",function(e){e.preventDefault();var t={};t.name=$("#name").val(),t.email=$("#email").val(),t.password=$("#password").val(),t=JSON.stringify(t);r().register(t).then(function(e){var t=e.data.jwt;a().setCookie("access_token="+t),"access_token=undefined"==a().getCookie()?alert("Already Registered"):($("#dashboardView").html(),Finch.navigate("dashboard"));a().log(e)},function(e){a().log(e)})}),$(document).on("submit","#forgetSubmit",function(n){n.preventDefault();var o=$("#email").val();(t={}).email=$("#email").val();var t=JSON.stringify(t);r().forget(t).then(function(e){if(n.preventDefault(),""==e.data)alert("Username Not Found");else{a().setCookie(o);var t=$("#recoveryView").html();Finch.navigate("recovery"),a().render(t)}},function(e){a().log(t)})}),$(document).on("submit","#recoverySubmit",function(e){e.preventDefault();var t={};t.token=$("#token").val(),t.password=$("#password").val(),t=JSON.stringify(t);r().recovery(t).then(function(e){var t=e.data.jwt;a().setCookie("access_token="+t);var n=$("#dashboardView").html();Finch.navigate("dashboard"),a().render(n),a().log(e)},function(e){a().log(e)})}),$(document).on("click","#token",function(e){e.preventDefault();var t=a().getCookie();(n={}).email=t;var n=JSON.stringify(n);r().resendEmail(n).then("onSuccess","onError")}),Finch.route("login",function(){e().renderLogin()}),Finch.route("register",function(){e().renderRegister()}),Finch.route("forget",function(){e().renderForget()}),Finch.route("dashboard",function(){e().renderDashboard()}),Finch.route("add",function(){var e;e=$("#addCategoryView").html(),a().render(e)}),$(document).ready(function(){Finch.listen()}),$(document).on("click",".navigator",function(e){e.preventDefault();var t=$(this).data("route");Finch.call(t)})}();